<!DOCTYPE html>
<meta charset="utf-8">
<title>Recorder Thing</title>
<button onclick="startRecording()">Start Recording</button>
<button onclick="stopRecording()">Stop Recording</button>
<div id="playback" style="padding-top: 10px;"></div>
<div id="wami" style="margin-left: 100px;"></div>
<!-- swfobject is a commonly used library to embed Flash content -->
<script src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>

<!-- Setup the recorder interface -->
<script type="text/javascript" src="recorder.js"></script>
<script>
var recordState = "loading";

function stopRecording() {
  if (recordState == "recording") {
    console.log("STOP HAZ BEEN CLICK'D");
    Wami.stopRecording();
    recordState = "uploading";
  }
}

function startRecording() {
  if (recordState != "idle")
    return;
  recordState = "recording";
  Wami.startRecording("/audio",
    Wami.nameCallback(function() {
      console.log("START");
    }),
    Wami.nameCallback(function() {
      var playback = document.getElementById("playback");
      var now = Date.now();
      playback.innerHTML = "";
      var audio = document.createElement("audio");
      audio.setAttribute("controls", "controls");
      var source = document.createElement("source");
      source.setAttribute("src", "outfile.mp3?bust=" + now);
      source.setAttribute("type", "audio/mp3");
      audio.appendChild(source);
      source = document.createElement("source");
      source.setAttribute("src", "outfile.ogg?bust=" + now);
      source.setAttribute("type", "audio/ogg");
      audio.appendChild(source);
      playback.appendChild(audio);
      recordState = "idle";
    }),
    Wami.nameCallback(function() {
      console.log("ERROR");
      alert("ERROR");
      recordState = "idle";
    })
  );
}

onload = function setupRecorder() {
  Wami.setup({
    id : "wami",
    onReady : function() {
      recordState = "idle";
    }
  });
};
</script>
